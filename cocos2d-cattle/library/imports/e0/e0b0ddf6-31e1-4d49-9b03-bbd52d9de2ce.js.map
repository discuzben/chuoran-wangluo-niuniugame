{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\resources\\script/assets\\resources\\script\\setting.js"],"names":["cc","Class","extends","Component","properties","settingBtn","Node","settingPanel","advicePage","setPage","exitPage","helpPage","paitypePage","recordPage","musicSwitchNode","effectSwitchNode","adviceEdit","EditBox","musiceSlider","Slider","effectSlider","recordItemPrefab","Prefab","recordContent","_emitEvent","name","data","director","emit","settingMain","isForce","isOpen","isSettingOpen","active","submitAdvice","text","API","post","gameId","GD","current","hallItem","content","playerId","status","result","ccUtil","modalTip","console","log","closeModal","self","_modal","runAction","sequence","scaleTo","callFunc","sliderCtrl","sender","sign","percent","Math","round","progress","targetNode","node","getChildByName","width","window","AudioCtrl","setMusicVolume","setEffectVolume","musicSwitch","musicOff","muteMusic","effectSwitch","effectOff","muteEffect","menuCtrl","event","setScale","initSet","initRecord","_showRecords","recordData","forEach","item","index","itemNode","instantiate","parent","moneyNode","find","amount","color","Color","setLabelString","hallName","recordTime","_getRecordData","pageSize","currentPageNum","recordPageNum","concat","logs","removeAllChildren","setting","musicVolume","effectVolume","musicLightBarWidget","right","effectLightBarWidget","isMusicMute","isEffectMute","exitCancel","exitSure","onLoad","ttt","getComponent","Widget","onDestroy","audioEngine","stopAll"],"mappings":"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","file":"setting.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\resources\\script","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        settingBtn: cc.Node,\r\n        settingPanel: cc.Node,\r\n        advicePage: cc.Node,\r\n        setPage: cc.Node,\r\n        exitPage: cc.Node,\r\n        helpPage: cc.Node,\r\n        paitypePage: cc.Node,\r\n        recordPage: cc.Node,\r\n        musicSwitchNode: cc.Node,\r\n        effectSwitchNode: cc.Node,\r\n        adviceEdit: cc.EditBox,\r\n        musiceSlider: cc.Slider,\r\n        effectSlider: cc.Slider,\r\n        recordItemPrefab: cc.Prefab,\r\n        recordContent: cc.Node\r\n    },\r\n\r\n    _emitEvent(name, data){\r\n        cc.director.emit('emit-setting-'+name, data);\r\n    },\r\n\r\n    settingMain(isForce,isOpen){\r\n        if(isForce === true){\r\n            this.isSettingOpen = !!isOpen;\r\n        }else{\r\n            this.isSettingOpen = !this.isSettingOpen;\r\n        }\r\n        if(this.isSettingOpen){\r\n            // this.settingBtn.runAction(cc.rotateTo(0.2, -90));\r\n            this.settingPanel.active = true;\r\n        }else{\r\n            // this.settingBtn.runAction(cc.rotateTo(0.2, 0));\r\n            this.settingPanel.active = false;\r\n        }\r\n    },\r\n\r\n    submitAdvice(){\r\n        let text = this.adviceEdit;\r\n        if(text){\r\n            API.post('/api/game/feedback', {gameId: GD.current.hallItem.gameId, content: text, playerId: GD.playerId}, (status, result)=>{\r\n                if(status){\r\n                    ccUtil.modalTip();\r\n                }else{\r\n                    console.log(result);\r\n                }\r\n            });\r\n        }\r\n\r\n        this.closeModal();\r\n    },\r\n\r\n    closeModal(){\r\n        let self = this;\r\n        let _modal = this._modal;\r\n        if(_modal){\r\n            delete this._modal;\r\n            _modal.runAction(cc.sequence(cc.scaleTo(0.1, 0.3), cc.callFunc(()=>{\r\n                _modal.active = false;\r\n            })));\r\n        }\r\n    },\r\n\r\n    sliderCtrl(sender, sign){\r\n        let percent = Math.round(sender.progress*10)/10;\r\n        let targetNode = sender.node.getChildByName('light');\r\n        targetNode.width = sender.node.width*percent;\r\n        if(sign == 'music'){\r\n            window.AudioCtrl.setMusicVolume(percent);\r\n        }else if(sign == 'effect'){\r\n            window.AudioCtrl.setEffectVolume(percent);\r\n        }\r\n    },\r\n\r\n    musicSwitch(){\r\n        this.musicOff = !this.musicOff;\r\n        this.musicSwitchNode.getChildByName('on').active = !this.musicOff;\r\n        this.musicSwitchNode.getChildByName('off').active = !!this.musicOff;\r\n\r\n        window.AudioCtrl.muteMusic(this.musicOff);\r\n    },\r\n\r\n    effectSwitch(){\r\n        this.effectOff = !this.effectOff;\r\n        this.effectSwitchNode.getChildByName('on').active = !this.effectOff;\r\n        this.effectSwitchNode.getChildByName('off').active = !!this.effectOff;\r\n\r\n        window.AudioCtrl.muteEffect(this.effectOff);\r\n    },\r\n\r\n    menuCtrl(event, sign){\r\n        this.closeModal();\r\n\r\n        if(sign == 'exit'){\r\n            this._modal = this.exitPage;\r\n        }else if(sign == 'set'){\r\n            this._modal = this.setPage;\r\n        }else if(sign == 'record'){\r\n            this._modal = this.recordPage;\r\n        }else if(sign == 'paiType'){\r\n            this._modal = this.paitypePage;\r\n        }else if(sign == 'help'){\r\n            this._modal = this.helpPage;\r\n        }else if(sign == 'advice'){\r\n            this._modal = this.advicePage;\r\n        }\r\n            \r\n        if(this._modal){\r\n            this._modal.setScale(0.3);\r\n            this._modal.active = true;\r\n            this._modal.runAction(cc.scaleTo(0.1, 1));\r\n\r\n            if(sign == 'set'){\r\n                this.initSet();\r\n            }else if(sign == 'record'){\r\n                this.initRecord();\r\n            }\r\n        }\r\n\r\n        this.settingMain(true, false);\r\n    },\r\n\r\n    _showRecords(){\r\n        this.recordData.forEach((item,index)=>{\r\n            let itemNode = cc.instantiate(this.recordItemPrefab);\r\n            itemNode.parent = this.recordContent;\r\n\r\n            // #EBC561  dealOperate\r\n            let moneyNode = cc.find('row_layout/money', itemNode);\r\n            if(item.amount >= 0){\r\n                item.amount = '+'+item.amount;\r\n                moneyNode.color = new cc.Color(233,192,99); \r\n            }else{\r\n                moneyNode.color = new cc.Color(90,214,73);\r\n            }\r\n\r\n            ccUtil.setLabelString(itemNode,'row_layout/index', index+1);\r\n            ccUtil.setLabelString(itemNode,'row_layout/room', item.hallName);\r\n            ccUtil.setLabelString(itemNode,'row_layout/money', item.amount);\r\n            ccUtil.setLabelString(itemNode,'row_layout/time', item.recordTime);\r\n        });\r\n    },\r\n\r\n    _getRecordData(){\r\n        let self = this;\r\n        API.post('/api/user/queryStatements',{gameId: GD.current.hallItem.gameId, pageSize: 10, currentPageNum: this.recordPageNum}, (status,data)=>{\r\n            if(status && data){\r\n                self.recordPageNum ++;\r\n                self.recordData = self.recordData.concat(data.logs);\r\n                self._showRecords();\r\n            }\r\n        });\r\n    },\r\n\r\n    initRecord(){\r\n        this.recordPageNum = 1;\r\n        this.recordData = [];\r\n        this.recordContent.removeAllChildren();\r\n        this._getRecordData();\r\n    },\r\n\r\n    initSet(){\r\n        this.musiceSlider.progress = GD.setting.musicVolume*1;\r\n        this.effectSlider.progress = GD.setting.effectVolume*1;\r\n\r\n        this.musicLightBarWidget.right = 1 - this.musiceSlider.progress;\r\n        this.effectLightBarWidget.right = 1 - this.effectSlider.progress;\r\n\r\n        this.musicOff = GD.setting.isMusicMute;\r\n        this.effectOff = GD.setting.isEffectMute;\r\n        \r\n        this.musicSwitchNode.getChildByName('on').active = !this.musicOff;\r\n        this.musicSwitchNode.getChildByName('off').active = !!this.musicOff;\r\n\r\n        this.effectSwitchNode.getChildByName('on').active = !this.effectOff;\r\n        this.effectSwitchNode.getChildByName('off').active = !!this.effectOff;\r\n    },\r\n\r\n    exitCancel(){\r\n        this.closeModal();\r\n    },\r\n\r\n    exitSure(){\r\n        this._emitEvent('exit');\r\n        this.closeModal();\r\n    },\r\n\r\n    onLoad(){\r\n        window.ttt = this;\r\n\r\n        this.musicLightBarWidget = this.musiceSlider.node.getChildByName('light').getComponent(cc.Widget);\r\n        this.effectLightBarWidget = this.effectSlider.node.getChildByName('light').getComponent(cc.Widget);\r\n    },\r\n\r\n    onDestroy () {\r\n        cc.audioEngine.stopAll();\r\n    },\r\n});\r\n"]}